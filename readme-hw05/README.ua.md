**Читать на других языках: [Русский](README.md), [Українська](README.ua.md).**

# Домашнє завдання 5

Створи гілку `05-images` з гілки `master`.

Продовж створення REST API для роботи з колекцією контактів. Додай можливість
завантаження аватарки користувача через
[Multer](https://github.com/expressjs/multer).

## Крок 1

Створи папку `public` для роздачі статики. У цій папці зроби папку `images`.
Налаштуй Express на роздачу статичних файлів з папки `public`.

Поклади будь-яке зображення в папку `public/images` і перевір що роздача статики
працює. При переході по такому URL браузер відобразить зображення.

```shell
http://locahost:<порт>/images/<імя файлу з розширенням>
```

## Крок 2

У схему користувача додай нову властивість `avatarURL` для зберігання
зображення.

```shell
{
  email: String,
  password: String,
  avatarURL: String,
  subscription: {
    type: String,
    enum: ["free", "pro", "premium"],
    default: "free"
  }
}
```

- Використовуй пакет gravatar для того, щоб при реєстрації нового користувача
  відразу згенерувати йому аватар за його email.
- Створи папку `tmp` в корені проекту і зберігай в неї створену аватарку.

## Крок 3

При реєстрації користувача:

- Створити зображення використовуючи генератор аватарок з кроку 2
- Перенеси аватар з папки `tmp` в папку `public/images`
- Створи URL для аватара. Наприклад
  `http://locahost:3000/images/<ім'я файлу з розширенням>`
- Збережи створений URL в поле `avatarURL` під час створення користувача

## Крок 4

Додай можливість поновлення даних вже створеного користувача, в тому числі
аватарки.

![avatar upload from postman](./avatar-upload.png)

```shell
# Запит
PATCH /users/avatars
Content-Type: multipart/form-data
Authorization: "Bearer token"
RequestBody: завантажений файл

# Успішна відповідь
Status: 200 OK
Content-Type: application/json
ResponseBody: {
  "avatarURL": "тут буде посилання на зображення"
}

# Неуспішна відповідь
Status: 401 BAD
Content-Type: application/json
ResponseBody: {
  "message": "Not authorized"
}
```

## Додаткове завдання - необов'язкове

### 1. Написати юніт-тести для мідлвара по авторизації

(за допомогою [mocha](https://www.npmjs.com/package/mocha),
[sinon](https://www.npmjs.com/package/sinon))

- всі методи і функції, що викликаються мідлваром (разом з next) повинні бути
  заглушені за допомогою sinon
- потрібно перевірити кількість викликів заглушок і аргументи з якими вони
  викликалися у випадках, коли:
  - користувач не передав токен в `Authorization` заголовку
  - токен користувача невалідний
  - токен користувача валідний

```
Підказка:
Іноді Вам може знадобиться перевизначити повернені значення
методів-заглушок
```

### 2. Написати приймальні тести для ендпоінта поновлення аватарок

(додатково потрібно буде використовувати
[supertest](https://www.npmjs.com/package/supertest))

Тести повинні перевіряти:

- повертається відповідь зі статус кодом 401, якщо токен користувача невалідний
- У разі, якщо все пройшло успішно, перевірити:
  - повертається відповідь зі статус кодом 200
  - чи повертається тіло відповіді в правильному форматі
  - додається чи `avatarUrl` в документ цільового користувача
